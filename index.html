<html>
<head>
	<title> 
	SPOILER WARNING!!
	</title>
	<meta name="description" content="This website is made to be a convenient way of spoiler tagging text when there is no native option available. "/>
	<meta property="og:title" content="SPOILER WARNING! "/> 
	<meta property="og:image" content="https://axeltong.github.io/Spoiler/warning.png" />
</head>
<body>
	
	<div id="decodedDisplay">
	
	</div>
	
	<script>
		const queryString = window.location.search;
		const urlParams = new URLSearchParams(queryString);
		const base64 = urlParams.get('base64');
		
		var display = document.getElementById("decodedDisplay") // get the output
		// var message = "Hello world!" // Input
		function sanitize(decoded) {
  	const map = {
 	     '&': '&amp;',
 	     '<': '&lt;',
 	     '>': '&gt;',
	      '"': '&quot;',
	      "'": '&#x27;',
	      "/": '&#x2F;',
	  };
	  const reg = /[&<>"'/]/ig;
	  return decoded.replace(reg, (match)=>(map[match]));
	}
		if (base64) {
		// base64 = btoa(message) // base64 encode
		// noBase64 = atob(base64) // base64 decode
		decoded = atob(base64)
		var decodeSanitized = sanitize(decoded)
		console.log(decodeSanitized)
		var decodedReady = decodeSanitized.replace(/(\r\n|\r|\n)/g, '<br>');
		//output.innerHTML = "Encoded: " + base64 + "<br>Decoded: " + noBase64 // Write to div element
		display.innerHTML = "<h1> Here it is! </h1> <br>" + decodedReady + "<br><br>"
		}
		else {
			display.innerHTML = ""
		}
	</script>
	<h1>
		Try it yourself!
	</h1>
	<p>
		Input your message here: 
	</p>
	<textarea id="message" name="message" rows="10" cols="20"></textarea>
	<button onclick="encode()">encode</button>

	<div id="encodedDisplay">
	
	</div>
	
	<script>
		function sanitize(message) {
  	const map = {
 	     '&': '&amp;',
 	     '<': '&lt;',
 	     '>': '&gt;',
	      '"': '&quot;',
	      "'": '&#x27;',
	      "/": '&#x2F;',
	  };
	  const reg = /[&<>"'/]/ig;
	  return message.replace(reg, (match)=>(map[match]));
	}
		var displayer = document.getElementById("encodedDisplay")
		function encode() {
			var message = document.getElementById("message").value
			var sanitizedMessage = sanitize(message)
			console.log(message)
			console.log(sanitizedMessage)
			var encoded = btoa(sanitizedMessage) // base64 encode
			console.log(encoded)
			var url = "https://axeltong.github.io/Spoiler/?base64=" + encoded
			displayer.innerHTML = "Share this link: " + url
		}
		
	</script>
</body>
</html>
